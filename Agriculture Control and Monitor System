#define BLYNK_PRINT Serial 
#define BLYNK_TEMPLATE_ID "TMPL4Xa9c0fB0" 
#define BLYNK_TEMPLATE_NAME "Smart acriculture system" 
#include <BlynkSimpleEsp8266.h> 
#include <ESP8266WiFi.h> 

#define MOISTURE_VALUE V0 
#define WATER_PUMP V1 

#define MoistureSensor A0
#define waterPump D3

char authentication[] = "yiaqLErX3dx3dzNj91D_5jQnhUC5W5JY"; 
char wifi_Name[] = "xxx"; 
char wifi_Password[] = "xxx" ; 

BlynkTimer timer; 
bool relayModule = 0;

void setup() {
  Serial.begin(9600); 
  pinMode(WaterPump, OUTPUT); 
  digitalWrite(WaterPump, HIGH); 

  Blynk.begin(authentication, wifi_Name, wifi_Password, "blynk.cloud", 80); 
  timer.setInterval(10L, readMoistureSensor); 
}

void loop() {
  timer.run();
  Blynk.run();
}

void readMoistureSensor() {
  int moistureValue = analogRead(MoistureSensor);
  moistureValue = map(moistureValue, 0, 1024, 0, 100); 
  moistureValue = (moistureValue - 100) * -1; 

  Blynk.virtualWrite(MOISTURE_VALUE, moistureValue); 
  controlPump(moistureValue);
  }

BLYNK_CONNECTED() {
  Blynk.syncAll(); 
}

BLYNK_WRITE(WATER_PUMP) {
  relayModule = param.asInt(); 

  if (relayModule == 1) {
    digitalWrite(WaterPump, LOW); 
  } else {
    digitalWrite(WaterPump, HIGH); 
  }
}
